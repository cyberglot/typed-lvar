\documentclass[main.tex]{subfiles}
\begin{document}

\section{Typed LVars: deterministic parallelism}
\usingnamespace{lvar}

\subsection{The \typedlambdalvar calculus}

\todo{%
  Describe \typedlambdalvar as a typing discipline for \lambdalvar, and explain
  that it will allow us to rid ourselves of the error reductions and the
  $\tm{\error}$ configuration.}

\todo{%
  If a location is typed with upper bound $d$, then it must eventually contain
  $d$ after fully evaluating the program. Otherwise, we can use the upper bound
  to write a get expression which blocks forever, and hence we'd lose progress.}

\paragraph*{Types}
Types ($\ty{T}$, $\ty{U}$),  and typing environments ($\ty{\Gamma}$) are defined by the following grammar:
\[
\begin{array}{lrll}
  \ty{T}, \ty{U}
  & \coloneqq & \ty{\tyunit}        & \text{units} \\
  & \sep      & \ty{\typrod{T}{U}}  & \text{pairs} \\
  & \sep      & \ty{\tyfun{T}{U}}   & \text{functions}\\
  & \sep      & \ty{\tyD{d}}        & \text{domain values }{\sqsubseteq d}\\
  & \sep      & \ty{\tyL{\frz}{d}}  & \text{location with values }{\sqsubseteq d}\\
  & \sep      & \ty{\tyJ}           & \text{thresholds}
  \\
  \ty{\Gamma}
  & \coloneqq & \ty{\envemp}
    \sep        \ty{\ty{\Gamma},\tmty{x}{T}}
                                    & \text{typing environments}
  \\
  \ty{\Sigma}
  & \coloneqq & \ty{\envemp}
    \sep        \ty{\ty{\Sigma},\tmty{l}{\tyL{d}{\frz}}}
                                    & \text{store typing environments}
\end{array}
\]
Types $\ty{\tyunit}$, $\ty{\typrod{T}{U}}$, and $\ty{\tyfun{T}{U}}$ are the standard unit, pair, and function types.
The type $\tyD{d}$ types domain values with the upper bound $d$.
The type $\tyL{\frz}{d}$ types locations which store values of type $\tyD{d}$.
Thresholds occur on both the type- and term-level. Each threshold type $\tyJ$ has only one inhabitant, which is the same threshold $\tmJ$ on the term-level.

We extend $\sqsubseteq$ to location types and store typing environments:
\begin{mathpar}
  \ty{\tyL{\frz}{d}}\sqsubseteq\ty{\tyL{\frz'}{d'}}
  =
  \ty{\frz}\sqsubseteq\ty{\frz'}\text{ and }\ty{d}\sqsubseteq\ty{d'}
  \\
  \ty{\Sigma}\sqsubseteq\ty{\Sigma'}
  =
  \forall(\ty{l}\in\dom({\ty{\Sigma}})).\ty{\Sigma(l)}\sqsubseteq\ty{\Sigma'(l)}
\end{mathpar}

\paragraph{Typing rules}%
\label{sec:lvar-typing}
\input{fig/typing}
\input{fig/typing-configurations}
See~\cref{fig:typing,fig:typing-configurations}.

\subsection{Metatheory}

\begin{restatable}[Substitution]{lemma}{lemsubstitution}
  \label{lem:substitution}
  If $\seq{\ty{\Gamma}\tmty{x}{T}}{\ty{\Sigma'}}{M}{U}$,
  $\seq{\ty{\Gamma}}{\ty{\Sigma}}{V}{T}$, and
  $\ty{\Sigma}\sqsubseteq\ty{\Sigma'}$, then\dots
\end{restatable}

\begin{restatable}[Subject reduction, $\redc$]{lemma}{lemsubjectreductionredc}
  \label{lem:subject-reduction-redc}
  If $\seq{\ty{\Gamma}}{\ty{\Sigma}}{C}{T}$ and $\tm{C}\redc\tm{C'}$,
  then $\seq{\ty{\Gamma}}{\ty{\Sigma'}}{C'}{T}$
  for some $\ty{\Sigma'}$ such that $\ty{\Sigma}\sqsubseteq\ty{\Sigma'}$.
\end{restatable}

\begin{restatable}[Subject reduction, $\rede$]{theorem}{thmsubjectreductionrede}
  \label{thm:subject-reduction-rede}
  If $\seq{\ty{\Gamma}}{\ty{\Sigma}}{C}{T}$ and $\tm{C}\rede\tm{C'}$,
  then $\seq{\ty{\Gamma}}{\ty{\Sigma'}}{C'}{T}$
  for some $\ty{\Sigma'}$ such that $\ty{\Sigma}\sqsubseteq\ty{\Sigma'}$.
\end{restatable}

\begin{restatable}[Progress, $\rede$]{theorem}{thmprogressrede}
  \label{thm:progress}
  If $\seq{\ty{\Gamma}}{\ty{\Sigma}}{C}{T}$, then:
  \begin{itemize}
  \item $\tm{C}\rede\tm{C'}$ for some $\tm{C'}$; or
  \item $\tm{C}=\tm{\config{V}{S}}$ for some $\tm{V}$ and $\tm{S}$.
  \end{itemize}
\end{restatable}

\begin{corollary}[Generalised Independence]
\end{corollary}

\begin{corollary}[Determinism, $\rede$]
\end{corollary}

\end{document}

%%% Local Variables:
%%% TeX-master: "main"
%%% End:
